{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "mada_admin.device_managment",
    "name" : "Device Managment",
    "deprecated" : false,
    "image" : "data:image/png;base64,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",
    "description" : "Customized entity table widget with preconfigured actions to create, update and delete devices.",
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 7.5,
      "sizeY" : 6.5,
      "resources" : [ ],
      "templateHtml" : "<tb-entities-table-widget \n    [ctx]=\"ctx\">\n</tb-entities-table-widget>",
      "templateCss" : "",
      "controllerScript" : "self.onInit = function() {\n}\n\nself.onDataUpdated = function() {\n    self.ctx.$scope.entitiesTableWidget.onDataUpdated();\n}\n\nself.typeParameters = function() {\n    return {\n        maxDatasources: 1,\n        hasDataPageLink: true,\n        warnOnPageDataOverflow: false,\n        dataKeysOptional: true\n    };\n}\n\nself.actionSources = function() {\n    return {\n        'actionCellButton': {\n            name: 'widget-action.action-cell-button',\n            multiple: true,\n            hasShowCondition: true\n        },\n        'rowClick': {\n            name: 'widget-action.row-click',\n            multiple: false\n        },\n        'rowDoubleClick': {\n            name: 'widget-action.row-double-click',\n            multiple: false\n        }\n    };\n}\n\nself.onDestroy = function() {\n}\n",
      "settingsSchema" : "",
      "dataKeySettingsSchema" : "",
      "settingsDirective" : "tb-entities-table-widget-settings",
      "dataKeySettingsDirective" : "tb-entities-table-key-settings",
      "defaultConfig" : "{\"timewindow\":{\"realtime\":{\"interval\":1000,\"timewindowMs\":86400000},\"aggregation\":{\"type\":\"NONE\",\"limit\":200}},\"showTitle\":true,\"backgroundColor\":\"#111217\",\"color\":\"#ffffff\",\"padding\":\"4px\",\"settings\":{\"entitiesTitle\":\"Device Management\",\"enableSearch\":true,\"enableSelectColumnDisplay\":true,\"enableStickyHeader\":true,\"enableStickyAction\":true,\"reserveSpaceForHiddenAction\":\"true\",\"displayEntityName\":true,\"displayEntityLabel\":false,\"displayEntityType\":true,\"displayPagination\":true,\"defaultPageSize\":10,\"defaultSortOrder\":\"entityName\",\"useRowStyleFunction\":false},\"title\":\"Device Managment\",\"dropShadow\":true,\"enableFullscreen\":true,\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400,\"padding\":\"5px 10px 5px 10px\"},\"useDashboardTimewindow\":false,\"showLegend\":false,\"datasources\":[{\"type\":\"function\",\"name\":\"Simulated\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#f44336\",\"settings\":{\"columnWidth\":\"0px\",\"useCellStyleFunction\":false,\"cellStyleFunction\":\"\",\"useCellContentFunction\":false,\"cellContentFunction\":\"\"},\"_hash\":0.6401141393938932,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"showTitleIcon\":false,\"titleIcon\":\"more_horiz\",\"iconColor\":\"rgba(0, 0, 0, 0.87)\",\"iconSize\":\"24px\",\"titleTooltip\":\"\",\"widgetStyle\":{},\"displayTimewindow\":true,\"actions\":{\"headerButton\":[{\"name\":\"Add device\",\"icon\":\"add\",\"type\":\"customPretty\",\"customHtml\":\"<form #addDeviceForm=\\\"ngForm\\\" [formGroup]=\\\"addDeviceFormGroup\\\"\\n      (ngSubmit)=\\\"save()\\\" style=\\\"width: 480px;\\\">\\n  <mat-toolbar fxLayout=\\\"row\\\" color=\\\"primary\\\">\\n    <h2>Add device</h2>\\n    <span fxFlex></span>\\n    <button mat-icon-button\\n            (click)=\\\"cancel()\\\"\\n            type=\\\"button\\\">\\n      <mat-icon class=\\\"material-icons\\\">close</mat-icon>\\n    </button>\\n  </mat-toolbar>\\n  <mat-progress-bar color=\\\"warn\\\" mode=\\\"indeterminate\\\" *ngIf=\\\"isLoading$ | async\\\">\\n  </mat-progress-bar>\\n  <div style=\\\"height: 4px;\\\" *ngIf=\\\"!(isLoading$ | async)\\\"></div>\\n  <div mat-dialog-content>\\n      <div class=\\\"mat-padding\\\" fxLayout=\\\"column\\\">\\n            <mat-form-field class=\\\"mat-block\\\">\\n                <mat-label>Device name</mat-label>\\n                <input matInput formControlName=\\\"deviceName\\\" required>\\n                <mat-error *ngIf=\\\"addDeviceFormGroup.get('deviceName').hasError('required')\\\">\\n                    Device name is required.\\n                </mat-error>\\n            </mat-form-field>\\n            <div fxLayout=\\\"row\\\" fxLayoutGap=\\\"8px\\\">\\n                <tb-entity-subtype-autocomplete\\n                    fxFlex=\\\"50\\\"\\n                    formControlName=\\\"deviceType\\\"\\n                    [required]=\\\"true\\\"\\n                    [entityType]=\\\"'DEVICE'\\\"\\n                ></tb-entity-subtype-autocomplete>\\n                <mat-form-field fxFlex=\\\"50\\\" class=\\\"mat-block\\\">\\n                    <mat-label>Label</mat-label>\\n                    <input matInput formControlName=\\\"deviceLabel\\\">\\n                </mat-form-field>\\n            </div>\\n            <div formGroupName=\\\"attributes\\\" fxLayout=\\\"row\\\" fxLayoutGap=\\\"8px\\\">\\n                <mat-form-field fxFlex=\\\"50\\\" class=\\\"mat-block\\\">\\n                    <mat-label>Latitude</mat-label>\\n                    <input type=\\\"number\\\" step=\\\"any\\\" matInput formControlName=\\\"latitude\\\">\\n                </mat-form-field>\\n                <mat-form-field fxFlex=\\\"50\\\" class=\\\"mat-block\\\">\\n                    <mat-label>Longitude</mat-label>\\n                    <input type=\\\"number\\\" step=\\\"any\\\" matInput formControlName=\\\"longitude\\\">\\n                </mat-form-field>\\n            </div>\\n      </div>  \\n  </div>\\n  <div mat-dialog-actions fxLayout=\\\"row\\\">\\n    <span fxFlex></span>\\n    <button mat-button color=\\\"primary\\\"\\n            type=\\\"button\\\"\\n            [disabled]=\\\"(isLoading$ | async)\\\"\\n            (click)=\\\"cancel()\\\" cdkFocusInitial>\\n      Cancel\\n    </button>\\n    <button mat-button mat-raised-button color=\\\"primary\\\"\\n            style=\\\"margin-right: 20px;\\\"\\n            type=\\\"submit\\\"\\n            [disabled]=\\\"(isLoading$ | async) || addDeviceForm.invalid || !addDeviceForm.dirty\\\">\\n      Create\\n    </button>\\n  </div>\\n</form>\\n\",\"customCss\":\"\",\"customFunction\":\"let $injector = widgetContext.$scope.$injector;\\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\\n\\nopenAddDeviceDialog();\\n\\nfunction openAddDeviceDialog() {\\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\\n}\\n\\nfunction AddDeviceDialogController(instance) {\\n    let vm = instance;\\n    \\n    vm.addDeviceFormGroup = vm.fb.group({\\n      deviceName: ['', [vm.validators.required]],\\n      deviceType: ['', [vm.validators.required]],\\n      deviceLabel: [''],\\n      attributes: vm.fb.group({\\n          latitude: [null],\\n          longitude: [null]\\n      })      \\n    });\\n    \\n    vm.cancel = function() {\\n        vm.dialogRef.close(null);\\n    };\\n    \\n    vm.save = function() {\\n        vm.addDeviceFormGroup.markAsPristine();\\n        let device = {\\n            name: vm.addDeviceFormGroup.get('deviceName').value,\\n            type: vm.addDeviceFormGroup.get('deviceType').value,\\n            label: vm.addDeviceFormGroup.get('deviceLabel').value\\n        };\\n        deviceService.saveDevice(device).subscribe(\\n            function (device) {\\n                saveAttributes(device.id).subscribe(\\n                    function () {\\n                        widgetContext.updateAliases();\\n                        vm.dialogRef.close(null);\\n                    }\\n                );\\n            }\\n        );\\n    };\\n    \\n    function saveAttributes(entityId) {\\n        let attributes = vm.addDeviceFormGroup.get('attributes').value;\\n        let attributesArray = [];\\n        for (let key in attributes) {\\n            attributesArray.push({key: key, value: attributes[key]});\\n        }\\n        if (attributesArray.length > 0) {\\n            return attributeService.saveEntityAttributes(entityId, \\\"SERVER_SCOPE\\\", attributesArray);\\n        } else {\\n            return widgetContext.rxjs.of([]);\\n        }\\n    }\\n}\",\"customResources\":[],\"id\":\"70837a9d-c3de-a9a7-03c5-dccd14998758\"}],\"actionCellButton\":[{\"name\":\"Edit device\",\"icon\":\"edit\",\"useShowWidgetActionFunction\":null,\"showWidgetActionFunction\":\"return true;\",\"type\":\"customPretty\",\"customHtml\":\"<form #editDeviceForm=\\\"ngForm\\\" [formGroup]=\\\"editDeviceFormGroup\\\"\\n      (ngSubmit)=\\\"save()\\\" style=\\\"width: 480px;\\\">\\n  <mat-toolbar fxLayout=\\\"row\\\" color=\\\"primary\\\">\\n    <h2>Edit device</h2>\\n    <span fxFlex></span>\\n    <button mat-icon-button\\n            (click)=\\\"cancel()\\\"\\n            type=\\\"button\\\">\\n      <mat-icon class=\\\"material-icons\\\">close</mat-icon>\\n    </button>\\n  </mat-toolbar>\\n  <mat-progress-bar color=\\\"warn\\\" mode=\\\"indeterminate\\\" *ngIf=\\\"isLoading$ | async\\\">\\n  </mat-progress-bar>\\n  <div style=\\\"height: 4px;\\\" *ngIf=\\\"!(isLoading$ | async)\\\"></div>\\n  <div mat-dialog-content>\\n      <div class=\\\"mat-padding\\\" fxLayout=\\\"column\\\">\\n            <mat-form-field class=\\\"mat-block\\\">\\n                <mat-label>Device name</mat-label>\\n                <input matInput formControlName=\\\"deviceName\\\" required>\\n                <mat-error *ngIf=\\\"editDeviceFormGroup.get('deviceName').hasError('required')\\\">\\n                    Device name is required.\\n                </mat-error>\\n            </mat-form-field>\\n            <div fxLayout=\\\"row\\\" fxLayoutGap=\\\"8px\\\">\\n                <tb-entity-subtype-autocomplete\\n                    fxFlex=\\\"50\\\"\\n                    formControlName=\\\"deviceType\\\"\\n                    [required]=\\\"true\\\"\\n                    [entityType]=\\\"'DEVICE'\\\"\\n                ></tb-entity-subtype-autocomplete>\\n                <mat-form-field fxFlex=\\\"50\\\" class=\\\"mat-block\\\">\\n                    <mat-label>Label</mat-label>\\n                    <input matInput formControlName=\\\"deviceLabel\\\">\\n                </mat-form-field>\\n            </div>\\n            <div formGroupName=\\\"attributes\\\" fxLayout=\\\"row\\\" fxLayoutGap=\\\"8px\\\">\\n                <mat-form-field fxFlex=\\\"50\\\" class=\\\"mat-block\\\">\\n                    <mat-label>Latitude</mat-label>\\n                    <input type=\\\"number\\\" step=\\\"any\\\" matInput formControlName=\\\"latitude\\\">\\n                </mat-form-field>\\n                <mat-form-field fxFlex=\\\"50\\\" class=\\\"mat-block\\\">\\n                    <mat-label>Longitude</mat-label>\\n                    <input type=\\\"number\\\" step=\\\"any\\\" matInput formControlName=\\\"longitude\\\">\\n                </mat-form-field>\\n            </div>\\n      </div>  \\n  </div>\\n  <div mat-dialog-actions fxLayout=\\\"row\\\">\\n    <span fxFlex></span>\\n    <button mat-button color=\\\"primary\\\"\\n            type=\\\"button\\\"\\n            [disabled]=\\\"(isLoading$ | async)\\\"\\n            (click)=\\\"cancel()\\\" cdkFocusInitial>\\n      Cancel\\n    </button>\\n    <button mat-button mat-raised-button color=\\\"primary\\\"\\n            style=\\\"margin-right: 20px;\\\"\\n            type=\\\"submit\\\"\\n            [disabled]=\\\"(isLoading$ | async) || editDeviceForm.invalid || !editDeviceForm.dirty\\\">\\n      Update\\n    </button>\\n  </div>\\n</form>\\n\",\"customCss\":\"\",\"customFunction\":\"let $injector = widgetContext.$scope.$injector;\\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\\n\\nopenEditDeviceDialog();\\n\\nfunction openEditDeviceDialog() {\\n    customDialog.customDialog(htmlTemplate, EditDeviceDialogController).subscribe();\\n}\\n\\nfunction EditDeviceDialogController(instance) {\\n    let vm = instance;\\n    \\n    vm.device = null;\\n    vm.attributes = {};\\n    \\n    vm.editDeviceFormGroup = vm.fb.group({\\n      deviceName: ['', [vm.validators.required]],\\n      deviceType: ['', [vm.validators.required]],\\n      deviceLabel: [''],\\n      attributes: vm.fb.group({\\n          latitude: [null],\\n          longitude: [null]\\n      })      \\n    });\\n    \\n    vm.cancel = function() {\\n        vm.dialogRef.close(null);\\n    };\\n    \\n    vm.save = function() {\\n        vm.editDeviceFormGroup.markAsPristine();\\n        if (vm.editDeviceFormGroup.get('deviceType').value !== vm.device.type) {\\n            delete vm.device.deviceProfileId;\\n        }\\n        vm.device.name = vm.editDeviceFormGroup.get('deviceName').value,\\n        vm.device.type = vm.editDeviceFormGroup.get('deviceType').value,\\n        vm.device.label = vm.editDeviceFormGroup.get('deviceLabel').value\\n        deviceService.saveDevice(vm.device).subscribe(\\n            function () {\\n                saveAttributes().subscribe(\\n                    function () {\\n                        widgetContext.updateAliases();\\n                        vm.dialogRef.close(null);\\n                    }\\n                );\\n            }\\n        );\\n    };\\n    \\n    getEntityInfo();\\n    \\n    function getEntityInfo() {\\n        deviceService.getDevice(entityId.id).subscribe(\\n            function (device) {\\n                attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE',\\n                                                    ['latitude', 'longitude']).subscribe(\\n                   function (attributes) {\\n                        for (let i = 0; i < attributes.length; i++) {\\n                            vm.attributes[attributes[i].key] = attributes[i].value; \\n                        }\\n                        vm.device = device;\\n                        vm.editDeviceFormGroup.patchValue(\\n                            {\\n                                deviceName: vm.device.name,\\n                                deviceType: vm.device.type,\\n                                deviceLabel: vm.device.label,\\n                                attributes: {\\n                                    latitude: vm.attributes.latitude,\\n                                    longitude: vm.attributes.longitude\\n                                }\\n                            }, {emitEvent: false}\\n                        );\\n                   } \\n                );\\n            }\\n        );    \\n    }\\n    \\n    function saveAttributes() {\\n        let attributes = vm.editDeviceFormGroup.get('attributes').value;\\n        let attributesArray = [];\\n        for (let key in attributes) {\\n            attributesArray.push({key: key, value: attributes[key]});\\n        }\\n        if (attributesArray.length > 0) {\\n            return attributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', attributesArray);\\n        } else {\\n            return widgetContext.rxjs.of([]);\\n        }\\n    }\\n}\",\"customResources\":[],\"openInSeparateDialog\":false,\"openInPopover\":false,\"id\":\"93931e52-5d7c-903e-67aa-b9435df44ff4\"},{\"name\":\"Delete device\",\"icon\":\"delete\",\"type\":\"custom\",\"customFunction\":\"let $injector = widgetContext.$scope.$injector;\\nlet dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\\n\\nopenDeleteDeviceDialog();\\n\\nfunction openDeleteDeviceDialog() {\\n    let title = \\\"Are you sure you want to delete the device \\\" + entityName +  \\\"?\\\";\\n    let content = \\\"Be careful, after the confirmation, the device and all related data will become unrecoverable!\\\";\\n    dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\\n        function (result) {\\n            if (result) {\\n                deleteDevice();\\n            }\\n        }\\n    );\\n}\\n\\nfunction deleteDevice() {\\n    deviceService.deleteDevice(entityId.id).subscribe(\\n        function () {\\n            widgetContext.updateAliases();\\n        }\\n    );\\n}\\n\",\"id\":\"ec2708f6-9ff0-186b-e4fc-7635ebfa3074\"},{\"name\":\"Assign to asset\",\"icon\":\"domain\",\"useShowWidgetActionFunction\":null,\"showWidgetActionFunction\":\"return true;\",\"type\":\"customPretty\",\"customHtml\":\"\\n<!--=======================================================================-->\\n<!--========================  Edit entity example  ========================-->\\n<!--=======================================================================-->\\n \\n<form #relatedAssetsForm=\\\"ngForm\\\" [formGroup]=\\\"relatedAssetsFormGroup\\\"\\n      (ngSubmit)=\\\"save()\\\"  class=\\\"edit-entity-form\\\">\\n    <mat-toolbar fxLayout=\\\"row\\\" color=\\\"primary\\\">\\n        <h2>{{deviceName}} Related Assets</h2>\\n        <span fxFlex></span>\\n        <button mat-icon-button (click)=\\\"cancel()\\\" type=\\\"button\\\">\\n            <mat-icon class=\\\"material-icons\\\">close</mat-icon>\\n        </button>\\n    </mat-toolbar>\\n    \\n    <mat-progress-bar color=\\\"warn\\\" mode=\\\"indeterminate\\\" *ngIf=\\\"isLoading$ | async\\\">\\n    </mat-progress-bar>\\n    <div style=\\\"height: 4px;\\\" *ngIf=\\\"!(isLoading$ | async)\\\"></div>\\n    \\n    <div mat-dialog-content fxLayout=\\\"column\\\">\\n        <mat-form-field fxFlex class=\\\"mat-block\\\">\\n            <mat-label>Asset Type</mat-label>\\n            <mat-select formControlName=\\\"assetType\\\" (selectionChange)=\\\"changeAssetType($event)\\\" required>\\n                <mat-option *ngFor=\\\"let assetType of assetTypes\\\" [value]=\\\"assetType.type\\\">\\n                  {{assetType.type}}\\n                </mat-option>\\n            </mat-select>\\n        </mat-form-field>\\n        \\n        <mat-form-field fxFlex class=\\\"mat-block\\\" *ngIf=\\\"relatedAssetsFormGroup.get('assetType').value\\\">\\n            <mat-label>{{assetNameLabel}}</mat-label>\\n            <mat-select formControlName=\\\"assetName\\\" (selectionChange)=\\\"changeAssetName($event)\\\" required>\\n                <!--<mat-option>Select {{relatedAssetsFormGroup.get(\\\"assetType\\\").value}}</mat-option>-->\\n                <mat-option value=\\\"none\\\">None</mat-option>\\n                <mat-option *ngFor=\\\"let asset of assets\\\" [value]=\\\"asset.name\\\">\\n                  {{asset.name}}\\n                </mat-option>\\n            </mat-select>\\n        </mat-form-field>\\n    </div>\\n    \\n    <div mat-dialog-actions fxLayout=\\\"row\\\" fxLayoutAlign=\\\"end center\\\">\\n        <button mat-button color=\\\"primary\\\"\\n                type=\\\"button\\\"\\n                [disabled]=\\\"(isLoading$ | async)\\\"\\n                (click)=\\\"cancel()\\\" cdkFocusInitial>\\n            Cancel\\n        </button>\\n        <button mat-button mat-raised-button color=\\\"primary\\\"\\n                type=\\\"submit\\\"\\n                [disabled]=\\\"(isLoading$ | async) || relatedAssetsForm.invalid || !relatedAssetsForm.dirty\\\">\\n            Save\\n        </button>\\n    </div>\\n</form>\\n\",\"customCss\":\"/*=======================================================================*/\\n/*==========  There are two examples: for edit and add entity  ==========*/\\n/*=======================================================================*/\\n/*========================  Edit entity example  ========================*/\\n/*=======================================================================*/\\n/*\\n.edit-entity-form .boolean-value-input {\\n    padding-left: 5px;\\n}\\n\\n.edit-entity-form .boolean-value-input .checkbox-label {\\n    margin-bottom: 8px;\\n    color: rgba(0,0,0,0.54);\\n    font-size: 12px;\\n}\\n\\n.relations-list .header {\\n    padding-right: 5px;\\n    padding-bottom: 5px;\\n    padding-left: 5px;\\n}\\n\\n.relations-list .header .cell {\\n    padding-right: 5px;\\n    padding-left: 5px;\\n    font-size: 12px;\\n    font-weight: 700;\\n    color: rgba(0, 0, 0, .54);\\n    white-space: nowrap;\\n}\\n\\n.relations-list .mat-form-field-infix {\\n    width: auto !important;\\n}\\n\\n.relations-list .body {\\n    padding-right: 5px;\\n    padding-bottom: 15px;\\n    padding-left: 5px;\\n}\\n\\n.relations-list .body .row {\\n    padding-top: 5px;\\n}\\n\\n.relations-list .body .cell {\\n    padding-right: 5px;\\n    padding-left: 5px;\\n}\\n\\n.relations-list .body .md-button {\\n    margin: 0;\\n}\\n*/\\n/*========================================================================*/\\n/*=========================  Add entity example  =========================*/\\n/*========================================================================*/\\n/*\\n.add-entity-form .boolean-value-input {\\n    padding-left: 5px;\\n}\\n\\n.add-entity-form .boolean-value-input .checkbox-label {\\n    margin-bottom: 8px;\\n    color: rgba(0,0,0,0.54);\\n    font-size: 12px;\\n}\\n\\n.relations-list .header {\\n    padding-right: 5px;\\n    padding-bottom: 5px;\\n    padding-left: 5px;\\n}\\n\\n.relations-list .header .cell {\\n    padding-right: 5px;\\n    padding-left: 5px;\\n    font-size: 12px;\\n    font-weight: 700;\\n    color: rgba(0, 0, 0, .54);\\n    white-space: nowrap;\\n}\\n\\n.relations-list .mat-form-field-infix {\\n    width: auto !important;\\n}\\n\\n.relations-list .body {\\n    padding-right: 5px;\\n    padding-bottom: 15px;\\n    padding-left: 5px;\\n}\\n\\n.relations-list .body .row {\\n    padding-top: 5px;\\n}\\n\\n.relations-list .body .cell {\\n    padding-right: 5px;\\n    padding-left: 5px;\\n}\\n\\n.relations-list .body .md-button {\\n    margin: 0;\\n}\\n*/\\n\",\"customFunction\":\"\\n/*=======================================================================*/\\n/*========================  Edit entity example  ========================*/\\n/*=======================================================================*/\\n\\nlet customDialog = widgetContext.customDialog;\\nlet assetService = widgetContext.assetService;\\nlet deviceService = widgetContext.deviceService;\\nlet entityRelationService = widgetContext.entityRelationService;\\nlet entityService = widgetContext.entityService;\\n\\n\\nopenRelatedAssetsDialog();\\n\\nfunction openRelatedAssetsDialog() {\\n    customDialog.customDialog(htmlTemplate, RelatedAssetsDialogController).subscribe();\\n}\\n\\nfunction RelatedAssetsDialogController(instance) {\\n    const defaultAssetType = \\\"Region\\\";\\n    let vm = instance;\\n    \\n    vm.deviceName = entityName;\\n    vm.assetTypes = [];\\n    vm.assets = [];\\n    vm.allAssets = [];\\n    vm.prevRelatedAssets = [];\\n    vm.assetNameLabel = defaultAssetType;\\n    \\n    // Make sure to add any new asset types to mapping array!!!\\n    const typesMap = [\\n        {assetType: \\\"Region\\\", relationType: \\\"Contains\\\"},\\n        {assetType: \\\"Team\\\", relationType: \\\"Manages\\\"}\\n    ];\\n    \\n    vm.values = {};\\n    \\n    typesMap.forEach(function(mapObj){\\n        vm.values[mapObj.assetType] = \\\"\\\";\\n    });\\n    \\n    vm.relatedAssetsFormGroup = vm.fb.group({\\n        assetType: [null, [vm.validators.required]],\\n        assetName: [\\\"none\\\", [vm.validators.required]],\\n    });\\n\\n    assetService.getAssetTypes().subscribe(function(assetTypesData){\\n        if(assetTypesData.length > 0){\\n            const allowedAssetTypes = typesMap.map(function(mapObj){\\n                return mapObj.assetType;\\n            });\\n            \\n            vm.assetTypes = assetTypesData.filter(function(assetType){\\n                return allowedAssetTypes.includes(assetType.type);\\n            });\\n            \\n            entityRelationService.findByTo(entityId).subscribe(function(res){\\n                const prevDeviceRelations = res;\\n                console.log(\\\"prevDeviceRelations\\\", prevDeviceRelations);\\n                \\n                if(prevDeviceRelations.length > 0){\\n                    const prevDeviceAssetRelations = prevDeviceRelations.filter(function(relation){\\n                        return relation.from.entityType === \\\"ASSET\\\";\\n                    });\\n                    \\n                    const relatedAssets = prevDeviceAssetRelations.map(function(relation){\\n                        return assetService.getAsset(relation.from.id);\\n                    });\\n                    \\n                    widgetContext.rxjs.forkJoin(relatedAssets).subscribe(function(relatedAssetsData){\\n                        console.log(\\\"related assets\\\", relatedAssetsData);\\n                        vm.prevRelatedAssets = relatedAssetsData;\\n                        \\n                        typesMap.forEach(function(mapObj){\\n                            const foundAsset = vm.prevRelatedAssets.find(function(asset){\\n                                return asset.type === mapObj.assetType;\\n                            });\\n                            \\n                            if(foundAsset)\\n                                vm.values[mapObj.assetType] = foundAsset.name;\\n                            else\\n                                vm.values[mapObj.assetType] = \\\"none\\\";\\n                        });\\n                        \\n                        console.log(\\\"first\\\", vm.values);\\n                        update(defaultAssetType);\\n                    });\\n                }else{\\n                    update(defaultAssetType);\\n                }\\n            });\\n        }\\n    });\\n    \\n    vm.cancel = function() {\\n        vm.dialogRef.close(null);\\n    };\\n    \\n    vm.save = function() {\\n        vm.relatedAssetsFormGroup.markAsPristine();\\n        \\n        const updateTasks = [];\\n        const deleteTasks = [];\\n        \\n        // Delete previous relations\\n        typesMap.forEach(function(mapObj){\\n            const {assetType, relationType} = mapObj;\\n            \\n            if(vm.prevRelatedAssets.length > 0){\\n                const assetsToDelete = vm.prevRelatedAssets.filter(function(asset){\\n                    return asset.type === assetType;\\n                });\\n                \\n                console.log(\\\"assets to delete\\\", assetsToDelete);\\n                \\n                if(assetsToDelete.length > 0){\\n                    assetsToDelete.forEach(function(asset){\\n                        deleteTasks.push(entityRelationService.deleteRelation(asset.id, relationType, entityId));\\n                    });\\n                }\\n            }\\n        });\\n        \\n        console.log(\\\"delete tasks\\\", deleteTasks);\\n        \\n        if(deleteTasks.length < 1){\\n            deleteTasks.push(widgetContext.rxjs.of([]));\\n        }\\n        \\n        widgetContext.rxjs.forkJoin(deleteTasks).subscribe(function(){\\n            // Update relations\\n            Object.keys(vm.values).forEach(function(assetType){\\n                const assetName = vm.values[assetType];\\n                const assetsByType = vm.allAssets.find(function(assetTypeData){\\n                    return assetTypeData.type === assetType;\\n                }).data;\\n                \\n                console.log(\\\"found assets of type\\\", assetsByType);\\n                console.log(\\\"asset name\\\", assetName);\\n                \\n                if(assetName !== \\\"none\\\"){\\n                    const asset = assetsByType.find(function(asset){\\n                        return asset.name === assetName;\\n                    });\\n                    \\n                    if(asset){\\n                        const entityRelation = {\\n                            from: asset.entityId,\\n                            to: entityId,\\n                            type: typesMap.find(function(mapObj){\\n                                return mapObj.assetType === assetType;\\n                            }).relationType,\\n                            typeGroup: \\\"COMMON\\\"\\n                        };\\n                        \\n                        updateTasks.push(entityRelationService.saveRelation(entityRelation));\\n                    }\\n                }else{\\n                    \\n                }\\n            });\\n            \\n            if(updateTasks.length > 0){\\n                widgetContext.rxjs.forkJoin(updateTasks).subscribe(function(){\\n                    widgetContext.updateAliases();\\n                    vm.dialogRef.close(null);\\n                });\\n            }else{\\n                widgetContext.updateAliases();\\n                vm.dialogRef.close(null);\\n            }\\n        });\\n    };\\n    \\n    vm.changeAssetType = function($event){\\n        const assetType = $event.value;\\n        update(assetType);\\n        \\n        vm.assetNameLabel = assetType;\\n        console.log(\\\"values\\\", vm.values);\\n    };\\n    \\n    vm.changeAssetName = function($event){\\n        const assetName = $event.value;\\n        const assetType = vm.relatedAssetsFormGroup.get(\\\"assetType\\\").value;\\n        console.log(\\\"asset\\\", assetName, \\\"type\\\", assetType);\\n        \\n        vm.values[assetType] = assetName;\\n    };\\n    \\n    function update(assetType){\\n        const assetTypesStr = vm.assetTypes.map(function(assetType){\\n            return assetType.type;\\n        });\\n        const entityDataQuery = {\\n            entityFilter: {\\n                type: \\\"entityType\\\",\\n                resolveMultiple: true,\\n                entityType: \\\"ASSET\\\"\\n            },\\n            pageLink: {\\n                pageSize: 1024,\\n                page: 0,\\n            },\\n            entityFields: [{\\n                    type: \\\"ENTITY_FIELD\\\",\\n                    key: \\\"name\\\"\\n                }, {\\n                    type: \\\"ENTITY_FIELD\\\",\\n                    key: \\\"label\\\"\\n                }, {\\n                    type: \\\"ENTITY_FIELD\\\",\\n                    key: \\\"type\\\"\\n                }\\n            ]\\n        };\\n        \\n        entityService.findEntityDataByQuery(entityDataQuery).subscribe(function(res){\\n            const entities = res.data;\\n            // Format the assets data\\n            const assets = assetTypesStr.map(function(type){\\n                let assetsData = [];\\n                // Get asset entities of each type \\n                const filteredEntites = entities.filter(function(entity){\\n                    return type === entity.latest.ENTITY_FIELD.type.value;\\n                });\\n                \\n                if(filteredEntites.length > 0){\\n                    assetsData = filteredEntites.map(function(entity){\\n                        return {\\n                            entityId: entity.entityId,\\n                            name: entity.latest.ENTITY_FIELD.name.value,\\n                            label: entity.latest.ENTITY_FIELD.label.value\\n                        };\\n                    });\\n                } \\n                \\n                return{ type, data: assetsData };\\n            });\\n            \\n            vm.allAssets = assets;\\n            \\n            if(assets.length > 0){\\n                vm.assets = assets.filter(function(asset){\\n                    return asset.type === assetType;\\n                })[0].data;\\n                \\n                // console.log(\\\"entities\\\", entities, \\\"assets\\\", vm.assets);\\n                // Get asset related to device of each asset type\\n                const relationType = typesMap.find(function(mapObj){\\n                    return mapObj.assetType === assetType;\\n                }).relationType;\\n                \\n                const assetQuery = {\\n                    relationType,\\n                    assetTypes: [assetType],\\n                    parameters: {\\n                        rootId: entityId.id,\\n                        rootType: \\\"DEVICE\\\",\\n                        direction: \\\"TO\\\",\\n                    }\\n                };\\n                \\n                assetService.findByQuery(assetQuery).subscribe(function(res){\\n                    console.log(\\\"assetquery\\\", res);\\n                    if(res.length > 0){\\n                        const asset = res[0];\\n                        vm.relatedAssetsFormGroup.patchValue({\\n                            assetName: asset.name,\\n                            assetType: asset.type\\n                        });\\n                        \\n                        vm.values[asset.type] = asset.name;\\n                    }else{\\n                        vm.relatedAssetsFormGroup.patchValue({\\n                            assetName: \\\"none\\\"\\n                        });\\n                    }\\n                });\\n            }\\n            \\n        });\\n    }\\n}\",\"customResources\":[],\"openInSeparateDialog\":false,\"openInPopover\":false,\"id\":\"b82181c5-26c0-ec19-ed55-6a5cf3a53304\"}]},\"widgetCss\":\"\",\"pageSize\":1024,\"noDataDisplayMessage\":\"\"}"
    },
    "externalId" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "ec611580-77dc-11ee-819d-0f0d9d5d78ac"
    }
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}