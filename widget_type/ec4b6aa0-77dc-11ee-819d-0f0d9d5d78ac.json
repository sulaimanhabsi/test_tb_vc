{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "mada_basic.states_card",
    "name" : "States Card",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "rpc",
      "sizeX" : 11.5,
      "sizeY" : 8.5,
      "resources" : [ ],
      "templateHtml" : "<div class=\"io-widget\" fxLayout=\"column\" fxLayoutAlign=\"space-between\" style=\"font-family: Tajawal, Roboto\">\n    <mat-spinner *ngIf=\"isLoading$ | async; else showData\"></mat-spinner>\n    <ng-template #showData>\n        <!--<div>-->\n        <div class=\"io-pins-container\" fxLayout=\"row wrap\" *ngIf=\"pins && pins.length > 0; else noPins\">\n            <div class=\"pin-card\" *ngFor=\"let pin of pins; let i = index\" [fxFlex]=\"pinCardWidth\" fxLayout=\"column\" fxLayoutGap=\"15px\">\n                <div fxLayout fxLayoutAlign=\"space-between\" *ngIf=\"isEditMode\">\n                    <button mat-icon-button color=\"accent\" aria-label=\"Settings icon button\" class=\"pin-card-btn\" (click)=\"openStatesListWindow($event, pin, i)\" matTooltip=\"State List\" matTooltipPosition=\"above\" *ngIf=\"isEditMode\">\n                        <mat-icon>settings</mat-icon>\n                    </button>\n                    <button mat-icon-button aria-label=\"Delete pin icon button\" class=\"pin-card-btn\" (click)=\"removePin($event, i, pin)\">\n                        <mat-icon>delete</mat-icon>\n                    </button>\n                </div>\n                <!--Pin Label Section-->\n                <div>\n                    <div class=\"pin-card-label\"\n                        *ngIf=\"!isEditMode; else labelInput\">\n                        {{pin.label}}\n                    </div>\n                    <ng-template #labelInput>\n                        <input type=\"text\"\n                            class=\"pin-card-label_input\"\n                            (input)=\"changeInput($event, inputTypes.LABEL, pin)\"\n                            [value]=\"pin.label\"\n                            placeholder=\"Pin Label\" />\n                    </ng-template>\n                </div>\n                <!--Pin Telemetry Key Section-->\n                <input *ngIf=\"isEditMode\" type=\"text\"\n                    class=\"pin-card-telemetryKey_input\"\n                    (input)=\"changeInput($event, inputTypes.TELEMETRY_KEY, pin)\"\n                    [value]=\"pin.telemetryKey\"\n                    placeholder=\"Telemetry Key\" />\n    \n                <div fxLayout fxLayoutAlign=\"space-between\">\n                    <!--Node ID Section-->\n                    <div fxLayout=\"column\"\n                        fxLayoutAlign=\"center center\" fxFlex=\"50px\">\n                        <div class=\"pin-card-nodeId_label\">\n                            Node ID</div>\n                        <div class=\"pin-card-nodeId\"\n                            *ngIf=\"!isEditMode; else nodeIdInput\">\n                            {{pin.nodeId}}\n                        </div>\n                        <ng-template #nodeIdInput>\n                            <input type=\"number\"\n                                class=\"pin-card-nodeId_input\"\n                                (input)=\"changeInput($event, inputTypes.NODE_ID, pin)\"\n                                [value]=\"pin.nodeId\" />\n                        </ng-template>\n                    </div>\n                    <!--Pin Number Section-->\n                    <div fxLayout=\"column\"\n                        fxLayoutAlign=\"center center\" fxFlex=\"50px\">\n                        <div class=\"pin-card-pinNumber_label\">\n                            Pin #\n                        </div>\n                        <div class=\"pin-card-pinNumber\"\n                            *ngIf=\"!isEditMode; else numberInput\">\n                            {{pin.number}}\n                        </div>\n                        <ng-template #numberInput>\n                            <input type=\"number\" \n                                class=\"pin-card-pinNumber_input\"\n                                (input)=\"changeInput($event, inputTypes.PIN_NUMBER, pin)\"\n                                [value]=\"pin.number\" />\n                        </ng-template>\n                    </div>\n                </div>\n                <!--Pin Status Section-->\n                <div style=\"margin-bottom: 3px\">\n                    <div class=\"pin-card-state\">{{pin.state}}</div>\n                </div>\n            </div>\n        </div>\n        <ng-template #noPins>\n            <div fxLayout fxLayoutAlign=\"center center\" class=\"no-data\">\n                <span>No Data Available</span>\n            </div>\n        </ng-template>\n    <!--</div>-->\n    </ng-template>\n    <div fxFlex=\"48px\" fxLayoutAlign=\"start\" fxLayoutGap=\"4px\"\n        class=\"io-widget-actions\" *ngIf=\"!readOnly\">\n        <button mat-icon-button color=\"accent\"\n            aria-label=\"Edit pin icon button\"\n            (click)=\"toggleEditMode()\"\n            [matTooltip]=\"isEditMode ? 'Apply Changes' : 'Edit Mode'\"\n            matTooltipPosition=\"above\">\n            <mat-icon *ngIf=\"!isEditMode; else checkIcon\">\n                edit</mat-icon>\n            <ng-template #checkIcon>\n                <mat-icon>check</mat-icon>\n            </ng-template>\n        </button>\n        <button mat-icon-button color=\"accent\"\n            aria-label=\"Add pin icon button\"\n            (click)=\"addPin()\" matTooltip=\"Add Pin\"\n            matTooltipPosition=\"above\" *ngIf=\"isEditMode\">\n            <mat-icon>add</mat-icon>\n        </button>\n    </div>\n</div>",
      "templateCss" : "@import url(\"https://fonts.googleapis.com/css?family=Tajawal\");\n\n#container {\n    /*overflow: auto;*/\n}\n\n.io-widget {\n    height: 100%;\n}\n\n.io-pins-container {\n    gap: 12px;\n    padding: 2px 0;\n    overflow: auto;\n}\n\n.no-data {\n    /*display: flex;*/\n    /*justify-content: center;*/\n    /*align-items: center;*/\n    height: 200px;\n    /*color: #7d7d7d;*/\n}\n\n.pin-card {\n    padding: 8px;\n    flex-direction: column;\n    border: none;\n    background-color: #212121;\n    justify-content:  center;\n    /*border-top: 1px solid #EBECF0;*/\n    /*border-left: 1px solid #EBECF0;*/\n    border-radius: 4px;\n    /*color: #3d3d3d;*/\n    /*box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);*/\n}\n\n.pin-card-btn {\n    /*position: absolute;*/\n    /*top: 0px;*/\n    /*right: 0;*/\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n}\n\n.pin-card-btn .mat-icon {\n    font-size: 18px;\n    width: 18px;\n    height: 18px;\n    line-height: 18px;\n    color: #7d7d7d;\n}\n\n.pin-card input {\n    border: none;\n    /*background-color: #e9eef5;*/\n    color: #ebebeb;\n    background-color: #424242;\n    transition: box-shadow 300ms ease;\n}\n\n.pin-card input:focus {\n    outline: none;\n\tbox-shadow: inset 0 0 0 2px #7d7d7d;\n}\n\n.pin-card-label,\n.pin-card-label_input,\n.pin-card-telemetryKey_input,\n.pin-card-pinNumber_input,\n.pin-card-nodeId_input {\n    text-align: center;\n    width: 100%;\n    padding: 3px 8px;\n}\n\n.pin-card-label_input,\n.pin-card-telemetryKey_input,\n.pin-card-pinNumber_input,\n.pin-card-nodeId_input {\n    border-radius: 3px;\n    /*color: #2d3748;*/\n}\n\n.pin-card-label,\n.pin-card-label_input {\n    /*text-transform: uppercase;*/\n    font-weight: bold;\n}\n\n\n.pin-card-label {\n    border: 1px solid rgba(255, 255, 255, 0);\n}\n\n.pin-card-nodeId {}\n\n.pin-card-nodeId_input {\n    /*width: 50px;*/\n}\n\n.pin-card-nodeId_label,\n.pin-card-pinNumber_label {\n    margin-bottom: 3px;\n    font-size: 14px;\n    /*color: #7d7d7d;*/\n    font-weight: bold;\n}\n\n.pin-card-pinNumber,\n.pin-card-nodeId {\n    font-size: 14px;\n    /*color: #4a5568;*/\n    text-align: center;\n}\n\n.pin-card-pinNumber {\n    width: 40px;\n}\n\n\n.pin-card-pinNumber_input {\n    width: 100%;\n}\n\n.pin-card-nodeId_input::-webkit-inner-spin-button,\n.pin-card-nodeId_input::-webkit-outer-spin-button,\n.pin-card-pinNumber_input::-webkit-inner-spin-button,\n.pin-card-pinNumber_input::-webkit-outer-spin-button{\n    opacity: 1;\n    display: none;\n}\n\n.pin-card-state {\n    color: #00b834;\n    font-size: 14px;\n    font-weight: bold;\n    height: 25px;\n    line-height: 25px;\n    text-align: center;\n}\n\n.io-widget-actions { \n    padding: 4px;\n    position: sticky;\n}\n\n/*.io-widget-actions button{*/\n/*    border: 1px solid #4caf50;*/\n/*    line-height: 40px;*/\n/*    height: 40px;*/\n/*    width: 40px;*/\n/*}*/\n/*.io-widget-actions button .mat-icon{*/\n/*    height: 24px;*/\n/*    width: 24px;*/\n/*    line-height: 24px;*/\n/*}*/\n",
      "controllerScript" : "var ctx = self.ctx;\nvar $container;\nvar $scope;\nvar settings = null;\nvar switchCardWidth;\nvar attributeService;\nvar telemetrySubscription;\nvar entityId;\n\n\nfunction fetchAttributes(entityId, keys) {\n    return attributeService.getEntityAttributes(entityId,\n        \"SERVER_SCOPE\", keys);\n}\n\nself.onInit = function() {\n    entityId = {\n        id: ctx.defaultSubscription.targetDeviceId,\n        entityType: \"DEVICE\"\n    };\n\n    attributeService = ctx.attributeService;\n    customDialog = ctx.customDialog;\n    settings = ctx.settings;\n\n    $scope = ctx.$scope;\n    $scope.pins = [];\n    $scope.errors = [];\n    $scope.currentStatesList = [];\n    $scope.currentPinIndex = [];\n    $scope.readOnly = settings.readOnly;\n    // console.log(\"Read only?\", $scope.readOnly)\n    // $scope.isEditMode = settings.isEditMode;\n    $scope.isEditMode = false;\n    $scope.pinCardWidth = settings.pinCardWidth + \"px\";\n    $scope.inputTypes = {\n        LABEL: \"LABEL\",\n        PIN_NUMBER: \"PIN_NUMBER\",\n        TELEMETRY_KEY: \"TELEMETRY_KEY\",\n        NODE_ID: \"NODE_ID\"\n    };\n  \n    ctx.ngZone.run(function() {\n        \n        fetchAttributes(entityId, [settings.statesAttribute]).subscribe(function(data) {\n            // console.log(\"ctx\", ctx, \"settings\", settings, \"pins\", data);\n\n            if (data.length < 1) return;\n            $scope.pins = data[0].value;\n            \n            if($scope.pins.length < 1) return;\n            \n            createTelemetryKeysSubscription();\n        });\n    });\n\n    $scope.addPin = function() {\n        $scope.pins.push({\n            label: \"\",\n            telemetryKey: \"\",\n            number: null,\n            nodeId: null,\n            state: \"DEFAULT\",\n            statesList: []\n        });\n    };\n\n    $scope.removePin = function($event, index, pinObj) {\n        $scope.pins.splice(index, 1);\n    };\n\n    // inputType = LABEL | PIN_NUMBER | TELEMETRY_KEY | NODE_ID\n    $scope.changeInput = function($event, inputType, pin, pinIndex) {\n        var value = $event.target.value;\n        var inputTypes = $scope.inputTypes;\n\n        switch (inputType) {\n            case inputTypes.LABEL:\n                pin.label = value;\n                break;\n            case inputTypes.PIN_NUMBER:\n                pin.number = value;\n                break;\n            case inputTypes.TELEMETRY_KEY:\n                pin.telemetryKey = value;\n                break;\n            case inputTypes.NODE_ID:\n                pin.nodeId = value;\n                break;\n        }\n    };\n\n    $scope.toggleEditMode = function() {\n        if ($scope.isEditMode) {\n            saveChanges();\n        }\n\n        if ($scope.errors.length < 1) {\n            $scope.isEditMode = !$scope.isEditMode;\n        }\n    };\n    \n    var StatesListDialogController = function(vm){\n        vm.hasUnknownState = false;\n        \n        var statesFbArray = Object.keys($scope.currentStatesList).map(function(value){\n            return vm.fb.group({\n                name: [$scope.currentStatesList[value], [vm.validators.required]],\n                value: [value, [vm.validators.required]]\n            });\n        });\n        \n        vm.statesListFormGroup = vm.fb.group({\n            statesList: vm.fb.array(statesFbArray)\n        });\n        \n        vm.errors = [];\n        \n        vm.cancel = function() {\n            vm.dialogRef.close(null);\n        };\n        \n        var checkErrors = function(formValues){\n            var errors = [];\n            var {statesList} = formValues;\n            // Check if user entered 'UNKNOWN' as state name\n            var hasUnknownState = formValues.statesList.some(function(state){\n                return state.name === \"UNKNOWN\";\n            });\n            \n            if(hasUnknownState) errors.push(\"'UNKNOWN' state name is reserved\");\n            \n            // Check for duplicate state values\n            var stateValues = statesList.map((state) =>  parseInt(state.value));\n            var hasDuplicateValues = (new Set(stateValues)).size !== stateValues.length;\n            \n            if(hasDuplicateValues) errors.push(\"Duplicate state values are not allowed\")\n            \n            return errors;\n        }\n        \n        vm.save = function(){\n            // console.log(\"<-----------SAVING------------>\");\n            var formValues = vm.statesListFormGroup.value;\n            \n            // console.log(\"Form values\", formValues);\n            \n            var errors = checkErrors(formValues);\n            // console.log(\"errors\", errors);\n            if(errors.length > 0){\n                vm.errors = errors;\n                return;\n            }\n            \n            vm.statesListFormGroup.markAsPristine();\n            vm.dialogRef.close(null);\n            \n            var statesList = {};\n            formValues.statesList.forEach(function(state){\n                statesList[state.value] = state.name;\n            });\n            \n            // console.log(\"states\", statesList)\n            $scope.pins[$scope.currentPinIndex].statesList = statesList;\n            ctx.showSuccessToast(\"Pin states saved!\");\n            \n        };\n        \n        vm.addState = function(){\n            var stateNumber = vm.statesList().controls.length;\n            var newState = vm.fb.group({\n                name: [\"STATE-\" + stateNumber, [vm.validators.required]],\n                value: [stateNumber, [vm.validators.required]]\n            });\n            \n            vm.statesList().push(newState);\n        };\n        \n        vm.removeState = function(stateIndex){\n            var pinObj = $scope.pins[$scope.currentPinIndex];\n            // console.log(\"pin\", pinObj, \"current pin index\", $scope.currentPinIndex, \"state index\", stateIndex, vm.statesList());\n            \n            vm.statesList().removeAt(stateIndex);\n            delete pinObj.statesList[stateIndex];\n            delete $scope.currentStatesList[stateIndex];\n        };\n        \n        vm.statesList = function(){\n            return vm.statesListFormGroup.get(\"statesList\");\n        };\n    };\n    \n    $scope.openStatesListWindow = function(e, pin, pinIndex){\n        // console.log(\"selected pin\", pinIndex, pin)\n        $scope.currentStatesList = pin.statesList || {};\n        $scope.currentPinIndex = pinIndex;\n        \n        var statesListHtml = `\n        <form #statesListForm=\"ngForm\" [formGroup]=\"statesListFormGroup\" (ngSubmit)=\"save()\" style=\"min-width: 400px\">\n            <mat-toolbar fxLayout=\"row\" color=\"primary\">\n                <h2>Pin States List</h2>\n                <span fxFlex></span>\n                <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n                    <mat-icon class=\"material-icons\">close</mat-icon>\n                </button>\n            </mat-toolbar>\n            <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n            </mat-progress-bar>\n            <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n            <div mat-dialog-content fxLayout=\"column\" fxLayoutGap=\"12px\">\n                <style>\n                    #states-list-form input[type=number]::-webkit-outer-spin-button{\n                        opacity: 1;\n                        display: none;\n                    }\n                    #states-list-form < ng-container < div < input{\n                        display: none;\n                    }\n                </style>\n                <div *ngIf=\"errors.length\" style=\"border-radius: 4px; background-color: #ffe3e4; color: #d40012; padding: 6px 8px; font-size: 12px\">\n                    <ul>\n                        <li *ngFor=\"let error of errors\">{{error}}</li>\n                    </ul>\n                </div>\n                <!--<div *ngIf=\"hasUnknownState\" style=\"border-radius: 4px; background-color: #ffe3e4; color: #d40012; padding: 6px 8px; font-size: 12px\">\n                    'UNKNOWN' state name is reserved!\n                </div>-->\n                <div id=\"states-list-form\" fxLayout=\"column\" fxLayoutGap=\"10px\">\n                    <ng-container formArrayName=\"statesList\" *ngFor=\"let state of statesList().controls; let i = index;\">\n                        <div [formGroupName]=\"i\" fxLayout=\"row\" fxLayoutAlign=\"start center\" fxLayoutGap=\"10px\" style=\"margin-bottom: 8px\">\n                            <input type=\"number\" min=\"0\" max=\"100\" matInput formControlName=\"value\" style=\"display: block; width: 40px; line-height: 36px; padding: 0px 8px; border: 1px solid #0000001f; border-radius: 4px;\">\n                            <input type=\"text\" matInput formControlName=\"name\" placeholder=\"State\" fxFlex=\"1 1 100%\" style=\"display: block; height: 38px; padding: 5px 8px; border: 1px solid #0000001f; border-radius: 4px;\">\n                            <button mat-stroked-button type=\"button\" (click)=\"removeState(i)\" matTooltip=\"Remove State\" style=\"height: 38px\">\n                                <mat-icon style=\"margin-right: 0; font-size: 20px; line-height: 20px\">delete</mat-icon>\n                            </button>\n                        </div>\n                    </ng-container>\n                </div>\n            </div>\n                <div fxLayout fxLayoutAlign=\"start center\" style=\"position: sticky; position: -webkit-sticky; padding: 10px 24px\">\n                    <button mat-button type=\"button\" color=\"primary\" (click)=\"addState($event)\" fxLayout style=\"padding-left: 2px\">\n                        <mat-icon style=\"font-size: 20px; line-height: 20px; display: inline-flex; align-items: center\">add</mat-icon>\n                        <span>New State</span>\n                    </button>\n                </div>\n            <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n                <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"(isLoading$ | async) || statesListForm.invalid\">\n                    Save\n                </button>\n            </div>\n        </form>\n        `;\n        customDialog.customDialog(statesListHtml, StatesListDialogController).subscribe();\n    };\n    \n    function onDataUpdated(subscription, detectChanges) {\n        if ($scope.isEditMode) return;\n\n        var subscData = subscription.data;\n\n        // console.log(\"onDataUpdated\", subscription);\n        if (subscData.length < 1) return;\n\n        subscData.forEach(function(keyData) {\n            if (!(keyData && keyData.data && keyData.data[0])) return;\n\n            var updatedDataKey = keyData.dataKey;\n\n            var pinToUpdate = $scope.pins.find(function(pin) {\n                return pin.telemetryKey === updatedDataKey.name;\n            });\n\n            var pinIndex = $scope.pins.findIndex(function(pin) {\n                return pin.telemetryKey === updatedDataKey.name;\n            });\n\n            var pinStateElementToUpdate = $(\".pin-card-state\").eq(pinIndex);\n\n            var newValue = keyData.data[0][1];\n\n            // console.log(\"updated dataKey:\", updatedDataKey, \"data\", newValue, \"pinToUpdate\", pinToUpdate, \"pin index\", pinIndex, \"pinStatusElementToUpdate\", pinStatusElementToUpdate);\n            var pinObj = $scope.pins[pinIndex];\n            var pinState = pinObj.statesList[newValue];\n            \n            // console.log(\"value:\", newValue, \"state:\", pinState)\n            if(pinState === undefined || pinState === null || pinState === \"\")\n                pinState = \"UNKNOWN\";\n\n            // console.log(\"pin\", pinObj.label, \", value:\", newValue, \", state:\", pinState);\n            if(pinState === \"UNKNOWN\")\n                pinStateElementToUpdate.css(\"color\", \"#d40012\");\n            else\n                pinStateElementToUpdate.css(\"color\", \"#00b834\");\n                \n            pinStateElementToUpdate.text(pinState);\n            $scope.pins[pinIndex].state = pinState;\n        })\n    }\n\n    function onDataUpdateError(subscription, e) {\n        // console.log(\"onDataUpdatedError\", e);\n    }\n\n    function createTelemetryKeysSubscription(){\n        var subscriptionOptions = {\n            callbacks: {\n                onDataUpdated: (subscription, detectChanges) => ctx.ngZone.run(() => {\n                        onDataUpdated(subscription, detectChanges);\n                }),\n                onDataUpdateError: (subscription, e) => ctx.ngZone.run(() => {\n                        onDataUpdateError(subscription, e);\n                }),\n                dataLoading: () => {}\n            }\n        };\n\n        var subscriptionsInfo = [{\n            type: \"entity\",\n            entityType: \"DEVICE\",\n            entityId: ctx.defaultSubscription.targetDeviceId\n        }];\n\n        subscriptionsInfo[0].timeseries = $scope.pins.map(function(pin) {\n            return {\n                name: pin.telemetryKey\n            }\n        });\n            \n        ctx.subscriptionApi.createSubscriptionFromInfo(\"latest\", subscriptionsInfo, subscriptionOptions, false, true).subscribe((subscription) => {\n            // console.log(\"subscription\", subscription);\n            telemetrySubscription = subscription\n            // Update 'statesAttribute' attribute\n            attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", [{\n                    key: settings.statesAttribute,\n                    value: $scope.pins\n            }]).subscribe(function() {\n                // console.log(\"<-------ATTRIBUTE SAVED------->\");\n            });\n        });\n    }\n    \n    function saveChanges() {\n        // console.log(\"<-----------SAVING----------->\");\n        // Ensure Configuration Name is defined and unique\n        \n        // Ensure all inputs are defined\n        if ($scope.pins.length > 0) {\n            $scope.errors = [];\n            $scope.pins.forEach((pin, index) => {\n                // console.log(\"pin\", pin);\n                var emptyInputs = {\n                    label: pin.label.trim() === \"\",\n                    telemetryKey: pin.telemetryKey.trim() === \"\",\n                    pinNumber: pin.number === null,\n                    nodeId: pin.nodeId === null,\n                };\n\n                var pinHasEmptyInputs = Object.keys(emptyInputs).some(function(key) {\n                    return emptyInputs[key] === true;\n                });\n\n                if (pinHasEmptyInputs){\n                    $scope.errors.push({\n                        pinIndex: index,\n                        emptyInputs: emptyInputs\n                    });\n                }\n            });\n        }\n        // Ensure there are no identical telemetryKeys\n        var telemetryKeys = $scope.pins.map((pin) =>  pin.telemetryKey);\n        var hasDuplicateKeys = (new Set(telemetryKeys)).size !== telemetryKeys.length;\n        // console.log(\"telemetry Keys\", telemetryKeys, \"duplication?\", hasDuplicateKeys);\n        if(hasDuplicateKeys){\n            $scope.errors.push({\n                duplicateTelemetryKeys: true\n            });\n        }\n        \n        // Check errors & save changes\n        if ($scope.errors.length > 0) {\n            // console.log(\"Errors\", $scope.errors);\n            if($scope.errors.some(error => error.emptyInputs))\n                ctx.showWarnToast(\"Empty input fields are not allowed\")\n            else if($scope.errors.some(error => error.duplicateTelemetryKeys))\n                ctx.showErrorToast(\"Duplicate telemetry keys are not allowed\")\n        } else {\n            // Remove state from pin object\n            $scope.pins.forEach(function(pin){\n                delete pin.state\n            })\n            // Create subscriptions to telemetry values\n            if(!telemetrySubscription){\n                // console.log(\"<-------CREATE SUBSCRIPTION------->\")\n                createTelemetryKeysSubscription();\n                \n            }else{\n                // console.log(\"<-------UPDATE SUBSCRIPTION------->\");\n                ctx.subscriptionApi.removeSubscription(telemetrySubscription.id)\n                createTelemetryKeysSubscription();\n            }\n        }\n    }\n};\n\nself.onDataUpdated = function() {}\n\nself.typeParameters = function() {\n    return {\n        maxDatasources: 1,\n        hasDataPageLink: false,\n        warnOnPageDataOverflow: false,\n        dataKeysOptional: true\n    };\n};\n\nself.onResize = function() {};\n\nself.onDestroy = function() {\n    // console.log(\"<------------DESTROY WIDGET------------>\")\n    // alert(\"Widget Destroyed\")\n    // Remove subscriptions and events\n    if(telemetrySubscription)\n        ctx.subscriptionApi.removeSubscription(telemetrySubscription.id);\n    \n    // Remove 'statesAttribute' attribute from device\n    // attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: settings.statesAttribute}]).subscribe(function(data){\n    //     console.log(\"<------DELETED ATTRIBUTE------>\")\n    // })\n};",
      "settingsSchema" : "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"States Widget\",\n        \"properties\": {\n            \"pinCardWidth\": {\n                \"title\": \"Pin Card Width (px)\",\n                \"type\": \"number\",\n                \"default\": 190\n            },\n            \"gap\": {\n                \"title\": \"Gap\",\n                \"type\": \"number\",\n                \"default\": 4\n            },\n            \"statesAttribute\": {\n                \"title\": \"Pin States Attribute\",\n                \"type\": \"string\",\n                \"default\": \"statesConfig\"\n            },\n            \"readOnly\": {\n                \"title\": \"Read Only\",\n                \"type\": \"boolean\",\n                \"default\": true\n            }\n        },\n        \"required\": [\"statesAttribute\"]\n    },\n    \"form\": [\n        \"widgetTitle\",\n        \"pinCardWidth\",\n        \"gap\",\n        \"statesAttribute\",\n        \"readOnly\"\n    ]\n}",
      "dataKeySettingsSchema" : "{}\n",
      "defaultConfig" : "{\"showTitle\":true,\"backgroundColor\":\"#111217\",\"color\":\"#ffffff\",\"padding\":\"8px\",\"settings\":{\"gap\":4,\"pinCardWidth\":190,\"ioConfigName\":\"ioConfig\",\"readOnly\":true},\"title\":\"States Card\",\"targetDeviceAliases\":[],\"targetDeviceAliasIds\":[\"05816267-5eba-8dba-22e8-bf7fd79c672d\"],\"showTitleIcon\":false,\"titleTooltip\":\"\",\"dropShadow\":true,\"enableFullscreen\":true,\"widgetStyle\":{},\"widgetCss\":\"\",\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"noDataDisplayMessage\":\"\",\"showLegend\":false}"
    },
    "externalId" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "ec4b6aa0-77dc-11ee-819d-0f0d9d5d78ac"
    }
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}