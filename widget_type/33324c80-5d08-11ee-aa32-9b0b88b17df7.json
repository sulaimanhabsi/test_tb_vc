{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "onsor_custom.svg_map",
    "name" : "SVG Map",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 8,
      "sizeY" : 5,
      "resources" : [ ],
      "templateHtml" : "",
      "templateCss" : "",
      "controllerScript" : "let settings;\nlet entyServices;\nlet widgetId;\nself.onInit = function() {\n    widgetId =   widgetId = self.ctx.widget.id;\n    self.ctx.$container.append(`<div height=\"100%\" width=\"100%\"  id=\"svg-container-${widgetId}\" ></div>`);\n    var $scope = self.ctx.$scope;\n    entityService = $scope.$injector.get(self.ctx.servicesMap.get('entityService'));\n    loadImage();\n    settings = self.ctx.settings;\n\n    $(`#svg-container-${widgetId}`).click((event)=>\n    {\n     \n        var clickedElementId = event.target.parentNode.id;\n        console.log();\n        // console.log('clickedElementId', clickedElementId);\n        var svgElements = self.ctx.settings.svgElements;\n        var clickedElementFromSetting = svgElements.find((element)=>{\n            return (element.elementId == clickedElementId);\n        });\n        console.log('clickedFromSetting', clickedElementFromSetting);\n        if (clickedElementFromSetting != undefined)\n        {\n            var entId = self.ctx.datasources.find((ds)=>{\n               return (ds.name == clickedElementFromSetting.entityName ) \n            });\n            // console.log(clickedElementFromSetting);\n            entId = entId.entity.id\n            // console.log(\"maped entity ID\",entId);\n            var actionDescriptors = self.ctx.actionsApi.getActionDescriptors('onMapedElementClicked');\n            self.ctx.actionsApi.handleWidgetAction(event, actionDescriptors[0],entId,clickedElementFromSetting.entityName);\n        }\n        \n    //   console.log(ad);\n    });\n   \n    self.onResize();\n}\n\nself.onDataUpdated = function() {\n  var data = self.ctx.data;\n  data.forEach((dt)=>{\n     try{\n     var sourceEntity = dt.datasource.name;\n     var level = dt.data[0][1];\n     var element = settings.svgElements.find((element)=>{\n        return (element.entityName == sourceEntity);\n    });\n    //  console.log(element);\n    \n    applyFilter(element.elementId, level);\n     }catch(ex)\n     {\n        //  console.log(ex);\n     }\n     \n  });\n}\n\nself.onResize = function() {\n \n}\n\nself.onDestroy = function() {\n}\nself.actionSources = function() {\n    return {\n        'onMapedElementClicked': {\n            name: 'On Mapped Element Clicked',\n            multiple: false\n        }\n    };\n}\n\nfunction loadImage()\n{\n    var img = ctx.settings.svgImage;\n    var svgId = ctx.settings.svgId;\n    img = img.split(',');\n    img = window.atob(img[1] );\n    img = img.replace(/<\\?xml.*\\?>/,'');\n    // console.log(img);\n    var $parsedHtml = jQuery.parseHTML(`${img}`);\n    var $svgTag = $parsedHtml.find((itm)=>{\n       return(itm.nodeName =='svg') ;\n    });\n    $svgImg = $($svgTag);\n    $svgImg.removeAttr('width');\n    $svgImg.removeAttr('height');\n    $svgImg.attr(\"height\",\"100%\")\n    // updating title for the tooltip \n    var targetSvgElements = ctx.settings.svgElements;\n    // console.log(JSON.stringify(targetSvgElements,null,2));\n    targetSvgElements.forEach((target)=>{\n        var ttt =$svgImg.children(`#${target.elementId}`).children('title');\n        ttt.text(`${target.entityName}`);\n    });\n    $(`#svg-container-${widgetId}`).append($svgImg);\n}\n\nfunction applyFilter(elementId, level){\n    var element = $(`#${elementId}`);\n    // console.log(element, elementId, level);\n    if (level==0)\n    {\n        element.removeClass();\n        element.addClass('green-fill');\n    }\n    else if (level == 1){\n        element.removeClass();\n        element.addClass('yellow-fill');\n    }\n    else if (level == 2){\n        element.removeClass();\n        element.addClass('red-fill');\n    }\n    \n}\n",
      "settingsSchema" : "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"properties\": {\n            \"svgImage\":{\n                \"title\":\"SVG Image\",\n                \"type\":\"string\",\n                \"default\":\"\"\n            },\n            \"svgId\":{\n                \"title\":\"SVG Tag ID\",\n                \"type\":\"string\",\n                \"default\":\"Layer_1\"\n            },\n            \"svgElements\":{\n                \"title\":\"Traget SVG Elements\",\n                \"type\":\"array\",\n                \"minItems\":0,\n                \"items\":{\n                    \"title\":\"Mapping SVG element to alias entityName\",\n                    \"type\":\"object\",\n                    \"properties\":{\n                        \"entityName\":{\n                          \"title\":\"Entity Name\",\n                          \"type\":\"string\"\n                        },\n                        \"elementId\":{\n                            \"title\":\"Target SVG element ID\",\n                            \"type\":\"string\"\n                        }\n                    }\n                }\n            }\n        },\n        \"required\": []\n    },\n    \"form\": [\n        {\n            \"key\":\"svgImage\",\n            \"type\":\"image\"\n        },\n        \"svgId\",\n        {\n            \"key\":\"svgElements\",\n            \"items\":[\n                \"svgElements[].entityName\",\n                \"svgElements[].elementId\"\n                ]\n            \n        }\n    ]\n}",
      "dataKeySettingsSchema" : "{}\n",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"function\",\"name\":\"OPAZ_DQM_RM3\",\"entityAliasId\":null,\"filterId\":null,\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"alarmLevel\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var temp = getRandomInt(0,3);\\r\\n\\r\\nfunction getRandomInt(min, max) {\\r\\n  min = Math.ceil(min);\\r\\n  max = Math.floor(max);\\r\\n  return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive\\r\\n}\\r\\n\\r\\nreturn temp;\",\"units\":null,\"decimals\":null,\"usePostProcessing\":null,\"postFuncBody\":null}]},{\"type\":\"function\",\"name\":\"OPAZ_DQM_RM1\",\"entityAliasId\":null,\"filterId\":null,\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"alarmLevel\",\"color\":\"#4caf50\",\"settings\":{},\"_hash\":0.9535343952935023,\"funcBody\":\"var temp = getRandomInt(0,3);\\r\\n\\r\\nfunction getRandomInt(min, max) {\\r\\n  min = Math.ceil(min);\\r\\n  max = Math.floor(max);\\r\\n  return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive\\r\\n}\\r\\n\\r\\nreturn temp;\",\"units\":null,\"decimals\":null,\"usePostProcessing\":null,\"postFuncBody\":null}]},{\"type\":\"function\",\"name\":\"OPAZ_DQM_RM2\",\"entityAliasId\":null,\"filterId\":null,\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"alarmLevel\",\"color\":\"#f44336\",\"settings\":{},\"_hash\":0.7624888602914974,\"funcBody\":\"var temp = getRandomInt(0,3);\\r\\n\\r\\nfunction getRandomInt(min, max) {\\r\\n  min = Math.ceil(min);\\r\\n  max = Math.floor(max);\\r\\n  return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive\\r\\n}\\r\\n\\r\\nreturn temp;\",\"units\":null,\"decimals\":null,\"usePostProcessing\":null,\"postFuncBody\":null}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#ffffff\",\"color\":\"#000000\",\"padding\":\"8px\",\"settings\":{\"svgElements\":[{\"entityName\":\"OPAZ_DQM_RM1\",\"elementId\":\"MLVLR3\"},{\"entityName\":\"OPAZ_DQM_RM2\",\"elementId\":\"MLVLL0\"},{\"entityName\":\"OPAZ_DQM_RM3\",\"elementId\":\"MLVLL1\"}],\"svgId\":\"Muscat_w\",\"svgImage\":\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTXVzY2F0X3ciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMTEzMCA2ODAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDExMzAgNjgwOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8ZGVmcz4NCgkJPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkJCS5ncmVlbi1maWxsew0KCQkJCWZpbGw6IzAwRkYwMDsNCgkJCQlmaWx0ZXI6IHVybCgjZGItZ3JlZW4tZ2xvdyk7DQoJCQkJfQ0KCQkJLnJlZC1maWxsew0KCQkJCWZpbGw6I0ZGMDAwMDsNCgkJCQlmaWx0ZXI6IHVybCgjZGItcmVkLWdsb3cpOw0KCQkJCX0NCgkJCS55ZWxsb3ctZmlsbHsNCgkJCQlmaWxsOiNGM0ZGMDA7DQoJCQkJZmlsdGVyOiB1cmwoI2RiLXllbGxvdy1nbG93KTsNCgkJCQl9DQoJCTwvc3R5bGU+CQkNCgkJPGZpbHRlciBpZD0iZGItYmx1ZS1nbG93IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIAkgIDxmZU9mZnNldCBkeD0iMCIgZHk9IjAiLz4NCiAgICAJICA8ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJibHVyMSIgc3RkRGV2aWF0aW9uPSI2Ii8+DQogICAgCSAgPGZlRmxvb2QgZmxvb2QtY29sb3I9IiM1NWMzZWEiIGZsb29kLW9wYWNpdHk9IjEiLz4NCiAgICAJICA8ZmVDb21wb3NpdGUgaW4yPSJibHVyMSIgb3BlcmF0b3I9ImluIi8+DQogICAgCSAgPGZlQ29tcG9zaXRlIGluPSJTb3VyY2VHcmFwaGljIi8+DQogICAgCTwvZmlsdGVyPg0KICAgIAk8ZmlsdGVyIGlkPSJkYi1yZWQtZ2xvdyIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIj4NCiAgICAJICA8ZmVPZmZzZXQgZHg9IjAiIGR5PSIwIi8+DQogICAgCSAgPGZlR2F1c3NpYW5CbHVyIHJlc3VsdD0iYmx1ci0yIiBzdGREZXZpYXRpb249IjYiLz4NCiAgICAJICA8ZmVGbG9vZCBmbG9vZC1jb2xvcj0iI2U1MjQyMSIgZmxvb2Qtb3BhY2l0eT0iMSIvPg0KICAgIAkgIDxmZUNvbXBvc2l0ZSBpbjI9ImJsdXItMiIgb3BlcmF0b3I9ImluIi8+DQogICAgCSAgPGZlQ29tcG9zaXRlIGluPSJTb3VyY2VHcmFwaGljIi8+DQogICAgCTwvZmlsdGVyPg0KCQk8ZmlsdGVyIGlkPSJkYi1ncmVlbi1nbG93IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIAkgIDxmZU9mZnNldCBkeD0iMCIgZHk9IjAiLz4NCiAgICAJICA8ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJibHVyLTIiIHN0ZERldmlhdGlvbj0iNiIvPg0KICAgIAkgIDxmZUZsb29kIGZsb29kLWNvbG9yPSIjMDBGRjAwIiBmbG9vZC1vcGFjaXR5PSIxIi8+DQogICAgCSAgPGZlQ29tcG9zaXRlIGluMj0iYmx1ci0yIiBvcGVyYXRvcj0iaW4iLz4NCiAgICAJICA8ZmVDb21wb3NpdGUgaW49IlNvdXJjZUdyYXBoaWMiLz4NCiAgICAJPC9maWx0ZXI+DQoJCTxmaWx0ZXIgaWQ9ImRiLXllbGxvdy1nbG93IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIAkgIDxmZU9mZnNldCBkeD0iMCIgZHk9IjAiLz4NCiAgICAJICA8ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJibHVyLTIiIHN0ZERldmlhdGlvbj0iNiIvPg0KICAgIAkgIDxmZUZsb29kIGZsb29kLWNvbG9yPSIjRjNGRjAwIiBmbG9vZC1vcGFjaXR5PSIxIi8+DQogICAgCSAgPGZlQ29tcG9zaXRlIGluMj0iYmx1ci0yIiBvcGVyYXRvcj0iaW4iLz4NCiAgICAJICA8ZmVDb21wb3NpdGUgaW49IlNvdXJjZUdyYXBoaWMiLz4NCiAgICAJPC9maWx0ZXI+DQoJIDwvZGVmcz4NCg0KPGcgIGlkPSJNTFZMTDAiIGNsYXNzPSJncmVlbi1maWxsIj4NCgk8dGl0bGU+Tm8gRGV2aWNlIE1hcHBlZDwvdGl0bGU+DQoJPHJlY3QgeD0iMzQwLjk5IiB5PSI1NDEuMzQiICB3aWR0aD0iOS4yMyIgaGVpZ2h0PSIxOS4wMiIvPg0KCTxyZWN0IHg9IjM1MS40MSIgeT0iNTQxLjM0IiAgd2lkdGg9IjkuMjMiIGhlaWdodD0iMTkuMDIiLz4NCgk8cmVjdCB4PSIzNDAuOTkiIHk9IjU2MS41MiIgIHdpZHRoPSIxOS42NCIgaGVpZ2h0PSI5LjM1Ii8+DQo8L2c+DQo8ZyAgaWQ9Ik1MVkxMMSIgY2xhc3M9ImdyZWVuLWZpbGwiPg0KCTx0aXRsZT5ObyBEZXZpY2UgTWFwcGVkPC90aXRsZT4NCgk8cmVjdCB4PSIzNDAuOTkiIHk9IjQ0NS42MSIgIHdpZHRoPSI5LjIzIiBoZWlnaHQ9IjE5LjAyIi8+DQoJPHJlY3QgeD0iMzUxLjAzIiB5PSI0NDUuNjEiICB3aWR0aD0iOS4yMyIgaGVpZ2h0PSIxOS4wMiIvPg0KCTxyZWN0IHg9IjM0MC45OSIgeT0iNDY1Ljc5IiAgd2lkdGg9IjE5LjI2IiBoZWlnaHQ9IjkuMzUiLz4NCjwvZz4NCjxnICBpZD0iTUxWTEwyIiBjbGFzcz0iZ3JlZW4tZmlsbCI+DQoJPHRpdGxlPk5vIERldmljZSBNYXBwZWQ8L3RpdGxlPg0KCTxyZWN0IHg9IjM0MC4zNSIgeT0iMzQ5LjU1IiAgd2lkdGg9IjkuNTQiIGhlaWdodD0iMTkuMzUiLz4NCgk8cmVjdCB4PSIzNTAuNyIgeT0iMzQ5LjU1IiAgd2lkdGg9IjkuMzMiIGhlaWdodD0iMTkuMzUiLz4NCgk8cmVjdCB4PSIzNDAuMzUiIHk9IjM2OS44NSIgIHdpZHRoPSIxOS42OCIgaGVpZ2h0PSI5LjI1Ii8+DQo8L2c+DQo8ZyAgaWQ9Ik1MVkxMMyIgY2xhc3M9ImdyZWVuLWZpbGwiPg0KCTx0aXRsZT5ObyBEZXZpY2UgTWFwcGVkPC90aXRsZT4NCgk8cmVjdCB4PSIzMzkuNSIgeT0iMjY0Ljg5IiAgd2lkdGg9IjkuNTQiIGhlaWdodD0iMTkuMzUiLz4NCgk8cmVjdCB4PSIzNDkuOTgiIHk9IjI2NC44OSIgIHdpZHRoPSI5LjQ0IiBoZWlnaHQ9IjE5LjM1Ii8+DQoJPHJlY3QgeD0iMzM5LjUiIHk9IjI4NS4xOCIgIHdpZHRoPSIxOS45MSIgaGVpZ2h0PSI5LjQ5Ii8+DQo8L2c+DQo8ZyAgaWQ9Ik1MVkxSMyIgY2xhc3M9ImdyZWVuLWZpbGwiPg0KCTx0aXRsZT5ObyBEZXZpY2UgTWFwcGVkPC90aXRsZT4NCgk8cmVjdCB4PSI0NjIuNjciIHk9IjI2NC44OSIgIHdpZHRoPSI5LjU0IiBoZWlnaHQ9IjE5LjM1Ii8+DQoJPHJlY3QgeD0iNDczLjE0IiB5PSIyNjQuODkiICB3aWR0aD0iOS40NCIgaGVpZ2h0PSIxOS4zNSIvPg0KCTxyZWN0IHg9IjQ2Mi42NyIgeT0iMjg1LjE4IiAgd2lkdGg9IjE5LjkxIiBoZWlnaHQ9IjkuNDkiLz4NCjwvZz4NCjwvc3ZnPg0K\"},\"title\":\"SVG Map\",\"actions\":{\"customAction\":[],\"mapedElementClick\":[],\"elementClick\":[],\"onMapedElementClicked\":[]},\"showTitleIcon\":false,\"titleTooltip\":\"\",\"dropShadow\":true,\"enableFullscreen\":true,\"widgetStyle\":{},\"widgetCss\":\"\",\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"noDataDisplayMessage\":\"\",\"showLegend\":false}"
    },
    "externalId" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "33324c80-5d08-11ee-aa32-9b0b88b17df7"
    }
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}